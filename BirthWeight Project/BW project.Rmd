---
title: "BW project"
author: "Healy Li"
date: "11/18/2022"
output:
  pdf_document: default
  html_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = F, message = F, warning = F)
```

```{r}
BW <- read.table("BirthsKingCounty2001-Biost514-517-2022.txt", header = T)
BW$sex <- ifelse(BW$sex == "M", 1, 0) # 1 represent male, otherwise female
BW$smoker <- ifelse(BW$smoker == "Y", 1, 0) # 1 represent smoke during pregnancy, otherwise don't
BW$drinker <- ifelse(BW$drinker == "Y", 1, 0) # 1 represent drink during pregnancy, otherwise don't

library("rigr")
library("ggplot2")
library("knitr")
library("ggpubr")
```

## Abstract 
This study explored whether “First Step” — a new provides free pre-natal care to low-income women — is helpful for increasing the birth weight of children. The information of 2500 newborns’ mother was collected and analyzed. 403 of them once participated in “First Step” and the rest did not. The average birth weight of the program participant is 3358.506 grams, which is 66.181 grams less than which of the non-participants, shows poor effect of this program regardless of the  confounders. After investigation,three risk factor that potentially affect the birth weight were identified: smoking, marriage and welfare. We make several recommendations to the board of Public Health King County about how did the program perform and how to improve the program's effect on increasing birth weight.


## Introduction
Birth weight of newborns is one of the most important factors that influence neonatal mortality. Children with lower birth weight are more likely to have medical problems, such as asthma, rental failure, diabetes, in their later life. Multiple studies have identified that lower birth weight is associated with the combination of biological, behavioral, environmental and medical factors. To help increase the infant birth weight for those mothers with low income, Seattle and King County began a program called "First Step" to provides free medical attention and advice about lifestyle decision for them. The aim of this study is to investigate whether participants in this program increases birth weight. 

## Result
The descriptive statistics of each variables stratifying by the participation of "First Step" program are shown in Table 1. The means of the variables `birthweight`, `wpre`, `wgain`, `education` and `gestation` are all deviated from their medians, which indicates that there are outliers exist. While the mean and median of the variable `age` are basically the same, hence it has no outliers. To be noticed that `birthweight` shows some evidences of left skewness(Graph 1). This might caused by the non-randomized selection of participants in the program. Women at high risk for low birth weight babies were encouraged to participate, hence participants in this program are more likely to have babies with low birth weight.

The overall difference of birth weight between participants and non-participants are -66.181 grams with a 95% CI (-130.416, -1.946), means that the newborns of the participants in "First Step" program are averagely 66.181 grams lighter than those of the non-participants. Among the 403 participants, 49% were single, 5.2% were on welfare and 13% were smoker. AS for the factor of race, most of the participants are white(0.47). Asian(0,13), black(0.15), Hispanic(0.22) and others races(0.03) are much more less than white(Table 5). The participants are neither older(p=1.000) nor more educated(p=1.000) than the non-participants, and there is no significant difference between two groups' weight gain during pregnancy(p=0.308), indicates that they are not confounding variables associate with the birth weight. Therefore, we determined that `smoker`, `welfare`, `married` and `race`to be potential risk factors that are associated with `firstep`.

According to table 2, the birth weight between smoker and non-smoker, single and non-single, welfare and non-welfare mothers are significantly different, while the birth weight between drinker and non-drinker mothers shows no difference(p=0.33) (Table2, Table3), indicates that besides `firstep`, `smoker`, `married` and `welfare` are also risk factors that could potentially influence infant birth weight. The effects of these factors on `firstep` are shown specifically by using boxplot. The difference of birth weight between participants and non-participants is not as large as which between smoker/non-smoker, married/non-married, welfare/non-welfare, showing that the effect of the `firstep` on birth weight is not larger than the effect of other risk factors(Graph 2). 

Among the three potential risk factors, we believe that the most amenable risk factor in this case is `smoker` since it is difficult to control the marriage status and welfare reception of an individual. However, the result from t-test showing that there is no significant difference in birth weight between participants and non-participants among mothers who were smokers(p=0.47). The same result exist in the non-smoker group as well(p=0.17)(Table 4).

The effect of the program did vary with race. There were some improvements shown in the birth weight of Asian and Hispanic participants, while there is no increases in birth weight of participant in white, black and other races(Graph 3). The percentage of "low birth" weight and "very low" birth weight in the participants are 6.2% and 1.5%, which are both higher than the non-participants group(4.9% and 0.5%)(Table 6)

```{r}
# Table 1
ds <- descrip(BW, strata = BW$firstep)
kable(ds[, 1:9], caption = "Descriptive Statistics Statified by firstep ")
```


```{r, eval=F}
# box plot for outliers
a <- ggplot(data = BW, aes(y = bwt)) + geom_boxplot()
b <- ggplot(data = BW, aes(y = age)) + geom_boxplot()
c <- ggplot(data = BW, aes(y = wpre)) + geom_boxplot()
d <- ggplot(data = BW, aes(y = wgain)) + geom_boxplot()
e <- ggplot(data = BW, aes(y = education)) + geom_boxplot()
f <- ggplot(data = BW, aes(y = gestation)) + geom_boxplot()
ggarrange(a, b, c, d, e, f, labels = c("birthWeight", "age", 
                                 "previousWeight", "weightGain", "education", "gestation"),
          ncol = 3, nrow = 2)
```


```{r}
# histogram of birth weight
ggplot(data = BW, aes(bwt)) + geom_histogram(binwidth = 50) + 
  ggtitle("Graph 1: Histogram of Birth Weight")
```


```{r}
# t-test for the difference between participants and non-participants
bw_diff <- mean(BW$bwt[BW$firstep == 1]) - mean(BW$bwt[BW$firstep == 0])
tt <- t.test(BW$bwt[BW$firstep == 1], BW$bwt[BW$firstep == 0], alternative = "less")
diff_tab <- matrix(c(bw_diff, tt$conf.int[1], tt$conf.int[2]), ncol = 3)
colnames(diff_tab) <- c("overall difference", "95% CI lower bound", "95% CI upper bound")
```

```{r}
N <- c(sum(BW$firstep), 2500-sum(BW$firstep))
prop_single <- c(mean(BW$married[BW$firstep==1]), mean(BW$married[BW$firstep==0]))
prop_welfare <- c(mean(BW$welfare[BW$firstep==1]), mean(BW$welfare[BW$firstep==0]))
prop_smoker <- c(mean(BW$smoker[BW$firstep==1]), mean(BW$smoker[BW$firstep==0]))
prop_drinker <- c(mean(BW$drinker[BW$firstep==1]), mean(BW$drinker[BW$firstep==0]))
tab <- rbind(N, prop_single, prop_welfare, prop_smoker, prop_drinker)
colnames(tab) <- c("participants", "non-participants")
```

```{r}
age_t <- t.test(BW$age[BW$firstep==1], BW$age[BW$firstep==0], 
       alternative = "greater") # participant in FS is not older than those who don't
edu_t <- t.test(BW$education[BW$firstep==1], BW$education[BW$firstep==0],
       alternative = "greater") # participants in FS are not more educated than those who don't
wgain_t <- t.test(BW$wgain[BW$firstep==1], BW$wgain[BW$firstep==0], 
       alternative = "two.sided") # there is no difference between the mean wight gain between participant and       
                                  # non-participant 
t_tab <- rbind(c(age_t$conf.int[1], age_t$conf.int[2], age_t$p.value),
      c(edu_t$conf.int[1], edu_t$conf.int[2], edu_t$p.value),
      c(wgain_t$conf.int[1], wgain_t$conf.int[2], wgain_t$p.value))
rownames(t_tab) <- c("age", "education", "weightGain")
colnames(t_tab) <- c("95% CI lower bound", "95% CI upper bound", "p-value")



race_tab <- table(BW$race, as.factor(BW$firstep))
race_tab <- cbind(race_tab[,1]/sum(BW$firstep==0), race_tab[,2]/sum(BW$firstep==1))
colnames(race_tab) <- c("non-participants", "participants")

```


```{r}
# table 2 & 3
tab4 <- as.table(rbind(descrip(BW$bwt, strata = BW$drinker), 
      descrip(BW$bwt, strata = BW$married), 
      descrip(BW$bwt, strata = BW$smoker), 
      descrip(BW$bwt, strata = BW$welfare))[, 1:9])

rownames(tab4) <- c("ALL", "non-drinker", "drinker", 
                    "ALL", "non-married", "married", 
                    "ALL", "non-smoker", "smoker", 
                    "ALL", "non-welfare", "welfare")

kable(tab4, caption = "Effect of Dichotomous Variables on Birth Weight")

drink <- t.test(BW$bwt[BW$drinker == 0], BW$bwt[BW$drinker == 1], alternative = "two.sided")
married <- t.test(BW$bwt[BW$married == 0], BW$bwt[BW$married == 1], alternative = "two.sided")
smoker <- t.test(BW$bwt[BW$smoker == 0], BW$bwt[BW$smoker == 1], alternative = "two.sided")
welfare <- t.test(BW$bwt[BW$welfare == 0], BW$bwt[BW$welfare == 1], alternative = "two.sided")

tt1 <- rbind(c(drink$p.value, drink$conf.int),
             c(married$p.value, married$conf.int), 
             c(smoker$p.value, smoker$conf.int),
             c(welfare$p.value, welfare$conf.int))
colnames(tt1) <- c("p-value", "95% CI lower bound", "95% CI upper bound")
rownames(tt1) <- c("drinker", "married", "smoker", "welfare")

kable(tt1, caption = "T-test for Potential Modifiable Dichotomous Variables")
```


```{r}
# graph 2
g <- ggplot(data = BW, aes(as.character(firstep), bwt)) + geom_boxplot() + xlab("firstep") 
h <- ggplot(data = BW, aes(as.character(smoker), bwt)) + geom_boxplot() + xlab("smoker")
i <- ggplot(data = BW, aes(as.character(welfare), bwt)) + geom_boxplot() + xlab("welfare")
j <- ggplot(data = BW, aes(as.character(married), bwt)) + geom_boxplot() + xlab("married")
G <- ggarrange(g, h, i, j, ncol = 2, nrow = 2)
annotate_figure(G, top = text_grob("Graph 2", size = 14))
```



```{r}
# t-test of participants and non-participants who smoke
sm <- t.test(BW$bwt[BW$smoker==1 & BW$firstep == 1], BW$bwt[BW$smoker==1 & BW$firstep == 0], 
       alternative = "two.sided")
nsm <- t.test(BW$bwt[BW$smoker==0 & BW$firstep == 1], BW$bwt[BW$smoker==0 & BW$firstep == 0], 
       alternative = "two.sided")

# make table 4
tabsm <- rbind(c(sm$p.value, sm$conf.int), c(nsm$p.value, nsm$conf.int))
colnames(tabsm) <- c("p-value", "95% CI lower bound", "95% CI upper bound")
rownames(tabsm) <- c("non_participants vs. participants(smoker)",
                     "non_participants vs. participants(non-smoker)")
kable(tabsm, caption = "Compare participants and non-participants(smoker)")
```


```{r}
# table 5: distribution of races and effect of program in races
kable(race_tab, caption = "Distribution of Different Races")
ggplot(data = BW, aes(race, bwt, color = as.character(firstep))) + geom_boxplot() +
  labs(color = "firstep") + ggtitle("Graph 3: Effect of Firstep in Different Races")
```

```{r}
# table 6
BW_fs <- subset(BW, BW$firstep==1)
fs_low <- sum(BW_fs$bwt < 2500)/nrow(BW_fs); fs_very_low <- sum(BW_fs$bwt < 1500)/nrow(BW_fs)
BW_nfs <- subset(BW, BW$firstep==0)
nfs_low <- sum(BW_nfs$bwt < 2500)/nrow(BW_nfs); nfs_very_low <- sum(BW_nfs$bwt < 1500)/nrow(BW_nfs)
bw_fs <- as.table(matrix(c(fs_low, fs_very_low, nfs_low, nfs_very_low), ncol=2))
rownames(bw_fs) <- c("low", "very low"); colnames(bw_fs) <- c("participant", "non-participants")
kable(bw_fs, caption = "Proportion of Low and Very Low Birth Weight")
```


## Discussion
The overall effect of "First Step" program is not as good as thought in this sample. The mean birth weight of participants(3358.506g) is 66.181g less than which of the non-participants(3424.687g). The proportion of the births with "low(<2500g)" and "very low(<1500g)" birth weight is also higher in the participants group. This might be caused by the bias of selection. Mothers at high risk for low birth weight babies were more likely to be recruited in the program, and they are also more possible to be exposed under the risk factors such as smoking, single and low-income(on welfare), which further decrease the birth weight of their children. Hence the data from participants are likely to be lower than which from the non-participants even thought they received the help from the program. 

According to the investigation, smoking, status of welfare and marriage are also risk factors that can influence infant birth weight. Smoking causes such effects because the harmful chemical in tobacco could damage the health of fetus which leads to over low of birth weight. Mothers who are on welfare indicates that their low income level, which makes them not able to afford a good living condition for themselves during pregnancy, eventually leads to low birth weight to their babies. Having a partner can provides both financial support and emotional support for a mother during pregnancy, which explain why single mothers are more likely to have babies with lower birth weight. Race is also a factor requires consideration since most of the participants were white while Asian and Hispanic group obviously received more benefits from the program.

Since the program is focusing on providing medical attention and advice about lifestyle decisions, status of welfare and marriage are likely immutable. So we recommend: (1) Advice the participants not to smoke during pregnancy or, in some circumstances, prohibit them from smoking since the current program did not adjust this risk factor enough. (2) Recruit more Asian and Hispanic participants and further investigate why they are more affected by this program. ""First Step"  could be more effective if it takes the risk factor "smoking" into account.

To be noticed that the imbalance between the sample size of participants(403) and non-participants(2097) could potentially cause extra bias to the result of the study. Future investigation about the effect of the program should base on a larger sample size hence the influence of "First Step" can be measured more accurately. Additionally, the program should also recruit mothers who are not at high risk of having low birth weight babies to eliminate the selection bias.




```{r, eval=F}
t.test(BW$bwt[BW$drinker == 0], BW$bwt[BW$drinker == 1], alternative = "two.sided")
t.test(BW$bwt[BW$smoker == 0], BW$bwt[BW$smoker == 1], alternative = "two.sided")
t.test(BW$bwt[BW$welfare == 0], BW$bwt[BW$welfare == 1], alternative = "two.sided")
t.test(BW$bwt[BW$married == 1], BW$bwt[BW$married == 0], alternative = "two.sided")

tab1 <- as.table(rbind(descrip(BW$bwt[BW$married==1]),
      descrip(BW$bwt[BW$married==1 & BW$firstep == 1]), 
      descrip(BW$bwt[BW$married==1 & BW$firstep == 0])))[, 1:9]

tab2 <- as.table(rbind(descrip(BW$bwt[BW$smoker==1]),
      descrip(BW$bwt[BW$smoker==1 & BW$firstep == 1]), 
      descrip(BW$bwt[BW$smoker==1 & BW$firstep == 0])))[, 1:9]

tab3 <- as.table(rbind(descrip(BW$bwt[BW$welfare==1]),
      descrip(BW$bwt[BW$welfare==1 & BW$firstep == 1]), 
      descrip(BW$bwt[BW$welfare==1 & BW$firstep == 0])))[, 1:9]

tab_total <- rbind(tab1, tab2, tab3)
rownames(tab_total) <- c("married", "participant", "non-participant",
                         "smoker", "participant", "non-participant",
                         "welfare", "participant", "non-participant")
kable(tab_total, caption = "Table 2")
```

```{r, eval=F}
kable(diff_tab, caption = "Table 3")
kable(tab, caption = "Table 4")
kable(t_tab, caption = "Table 5")
kable(race_tab, caption = "Table 6")
```